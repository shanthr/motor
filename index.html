<!DOCTYPE html>
<html>
<head>
  <title>Motor + Water Level</title>

  <style>
    body {
      background: #1e1e1e;
      color: white;
      text-align: center;
      font-family: Arial;
    }

    /* MOTOR */
    .gear {
      width: 60px;
      height: 60px;
      margin: 30px auto;
      border-radius: 50%;
      background: radial-gradient(#bbb, #333);
      animation: spin 1s linear infinite;
      animation-play-state: paused;
    }

    @keyframes spin {
      from { transform: rotate(0); }
      to { transform: rotate(360deg); }
    }

    /* TANK */
    .tank {
      width: 120px;
      height: 250px;
      border: 3px solid #aaa;
      margin: 20px auto;
      position: relative;
      overflow: hidden;
    }

    .water {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 0%;
      background: blue;
      transition: height 0.8s;
    }

    .percent {
      font-size: 22px;
    }
  </style>
</head>

<body>

<h2>Motor + Water Monitor</h2>

<div id="gear" class="gear"></div>

<button onclick="motorOn()">ON</button>
<button onclick="motorOff()">STOP</button>

<div class="tank">
  <div id="water" class="water"></div>
</div>

<div id="percent" class="percent">0%</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const config = {
  apiKey: "AIzaSyBwFxRZ_JWBVkTRoP1nYsLPQuzfw2XEWnA",
  databaseURL: "https://esp-firebase-demo-42-default-rtdb.firebaseio.com/"
};

firebase.initializeApp(config);
const db = firebase.database();

const gear = document.getElementById("gear");
const water = document.getElementById("water");
const percent = document.getElementById("percent");

// MOTOR CONTROL
function motorOn() {
  db.ref("motor/state").set("ON");
}

function motorOff() {
  db.ref("motor/state").set("OFF");
}

// MOTOR SYNC
db.ref("motor/state").on("value", snap => {
  if (snap.val() === "ON") {
    gear.style.animationPlayState = "running";
  } else {
    gear.style.animationPlayState = "paused";
  }
});

// WATER LEVEL SYNC
db.ref("water/percentage").on("value", snap => {
  let val = snap.val();
  if (val == null) return;

  val = Math.round(val);

  water.style.height = val + "%";
  percent.innerText = val + "%";

  // COLOR LOGIC
  if (val < 20) water.style.background = "red";
  else if (val < 50) water.style.background = "orange";
  else water.style.background = "blue";
});
</script>

</body>
</html>

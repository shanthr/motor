<!DOCTYPE html>
<html>
<head>
  <title>Motor + Water Level</title>

  <style>
    body {
      background: #1e1e1e;
      color: white;
      text-align: center;
      font-family: Arial;
    }

    /* MAIN ROW LAYOUT */
    .system {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 40px;
      margin-top: 30px;
      flex-wrap: wrap; /* helps on mobile */
    }

    /* MOTOR */
    .motor-container video,
    .motor-container img {
      width: 180px;
      border-radius: 10px;
    }

    /* PIPE */
    .pipe {
      width: 120px;
      height: 20px;
      background: #555;
      position: relative;
      border-radius: 10px;
      overflow: hidden;
    }

    /* FLOW ANIMATION */
    .flow {
      position: absolute;
      width: 200%;
      height: 100%;
      background: repeating-linear-gradient(
        90deg,
        #00bfff 0px,
        #00bfff 10px,
        #0077ff 10px,
        #0077ff 20px
      );
      animation: flowAnim 1s linear infinite;
      display: none;
    }

    @keyframes flowAnim {
      from { transform: translateX(-50%); }
      to { transform: translateX(0%); }
    }

    /* TANK */
    .tank {
      width: 120px;
      height: 250px;
      border: 3px solid #aaa;
      position: relative;
      overflow: hidden;
    }

    .water {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 0%;
      background: blue;
      transition: height 0.8s;
    }

    .percent {
      font-size: 22px;
      margin-top: 10px;
    }

    button {
      margin: 5px;
      padding: 6px 12px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<h2>Motor + Water Monitor</h2>

<div>
  <button onclick="motorOn()">START</button>
  <button onclick="motorOff()">STOP</button>
</div>

<div class="system">

  <!-- MOTOR -->
  <div class="motor-container">
    <video id="motorVideo" loop muted playsinline webkit-playsinline style="display:none;">
      <source src="motor_on.mp4" type="video/mp4">
    </video>
    <img id="motorImage" src="motor_off.png">
  </div>

  <!-- PIPE -->
  <div class="pipe">
    <div id="flow" class="flow"></div>
  </div>

  <!-- TANK -->
  <div>
    <div class="tank">
      <div id="water" class="water"></div>
    </div>
    <div id="percent" class="percent">0%</div>
  </div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const config = {
  apiKey: "AIzaSyBwFxRZ_JWBVkTRoP1nYsLPQuzfw2XEWnA",
  databaseURL: "https://esp-firebase-demo-42-default-rtdb.firebaseio.com/"
};

firebase.initializeApp(config);
const db = firebase.database();

const video = document.getElementById("motorVideo");
const image = document.getElementById("motorImage");
const flow = document.getElementById("flow");

const water = document.getElementById("water");
const percent = document.getElementById("percent");

// EXTRA SAFETY FOR MOBILE
video.setAttribute("playsinline", true);
video.setAttribute("webkit-playsinline", true);

// MOTOR CONTROL
function motorOn() {
  db.ref("motor/state").set("ON");
}

function motorOff() {
  db.ref("motor/state").set("OFF");
}

// MOTOR SYNC + FLOW
db.ref("motor/state").on("value", snap => {
  if (snap.val() === "ON") {
    image.style.display = "none";
    video.style.display = "block";
    video.play();

    flow.style.display = "block";
  } else {
    video.pause();
    video.style.display = "none";
    image.style.display = "block";

    flow.style.display = "none";
  }
});

// WATER LEVEL (UNCHANGED)
db.ref("water/percentage").on("value", snap => {
  let val = snap.val();
  if (val == null) return;

  val = Math.round(val);

  water.style.height = val + "%";
  percent.innerText = val + "%";

  if (val < 20) water.style.background = "red";
  else if (val < 50) water.style.background = "orange";
  else water.style.background = "blue";
});
</script>

</body>
</html>
